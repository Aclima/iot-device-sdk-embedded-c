<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Google Cloud IoT device SDK for embedded C 1.0.2: Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Google Cloud IoT device SDK for embedded C 1.0.2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Cloud IoT device SDK for embedded C is a library of source files for securely connecting to and communicating with <a href="https://cloud.google.com/iot-core/">Cloud IoT Core</a>. The SDK is designed for embedded IoT devices, <a href="../../../user_guide.md#feature-overview">so it</a>:</p>
<ul>
<li>Communicates over MQTT v3.1.1 with TLS</li>
<li>Publishes and subscribes asychronously</li>
<li>Abstracts hardware-specific drivers and routines in the Board Support Package</li>
<li>Runs on single, non-blocking thread and operates a thread-safe event queue</li>
</ul>
<p>The repository has example client applications for connecting:</p>
<ul>
<li><a href="../../../../examples/iot_core_mqtt_client">Native Linux</a> devices to Cloud IoT Core</li>
<li><a href="../../../../examples/zephyr_native_posix">Zephyr <code>native_posix</code></a> boards to Cloud IoT Core</li>
<li><a href="../../../../examples/freertos_linux/Linux_gcc_gcp_iot">FreeRTOS</a> platforms to Cloud IoT Core</li>
</ul>
<h1>Quickstart on a POSIX platform</h1>
<p>This section shows you how to create a client application on a Linux device and publish telemetry events to Cloud IoT Core.</p>
<p>Client applications build natively on POSIX platforms, so you don't need to customize the Board Support Package. You'll build this client application with mbedTLS, the default TLS library.</p>
<p>Before connecting to Cloud IoT Core, <a href="https://cloud.google.com/iot/docs/how-tos/devices">register the device</a> with an <a href="https://cloud.google.com/iot/docs/how-tos/credentials/keys#generating_an_elliptic_curve_keys">Elliptic Curve key pair</a>.</p>
<h2>Download the SDK</h2>
<div class="fragment"><div class="line">git clone https://github.com/GoogleCloudPlatform/iot-device-sdk-embedded-c.git</div></div><!-- fragment --><h2>Create a client application</h2>
<p>The client application is a C program that connects to an interacts with Cloud IoT Core. This client application publishes telemetry events from a native Linux device to Cloud IoT Core.</p>
<p>To start, create a C file called my_iot_app.c and paste in the code snippets to:</p>
<ol type="1">
<li>Initialize the SDK</li>
<li>Connect to Cloud IoT Core</li>
<li>Publish telemetry events to Cloud IoT Core</li>
</ol>
<h3>Initialize the SDK</h3>
<ol>
<li>
<p class="startli">Link the SDK to your client application:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="d9/d22/iotc_8h.html">iotc.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="d4/d7c/iotc__error_8h.html">iotc_error.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="d8/df1/iotc__jwt_8h.html">iotc_jwt.h</a>&gt;</span></div></div><!-- fragment -->  </li>
<li>
<p class="startli">Initialize the BSP time and random number libraries:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="d4/d7c/iotc__error_8h.html#a31af29ceaf88c8f978117b3be5545932">iotc_state_t</a> error_init = <a class="code" href="d9/d22/iotc_8h.html#a949c6fa4e75efb1814aa5cbedf742c12">iotc_initialize</a>();</div></div><!-- fragment --><p class="endli">The TLS library uses these functions to create JWTs.  </p>
</li>
</ol>
<h3>Communicate with Cloud IoT Core</h3>
<ol>
<li>
<p class="startli">Create a connection context:</p>
<div class="fragment"><div class="line">iotc_context = <a class="code" href="d9/d22/iotc_8h.html#a657294c0f1cda3a8ec5a2bb284709657">iotc_create_context</a>();</div></div><!-- fragment --><p class="endli">The context represents the socket connection, so the client applications knows where to publish telemetry events.  </p>
</li>
<li>
<p class="startli">Create a JWT:</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span> jwt[<a class="code" href="d8/df1/iotc__jwt_8h.html#ac7a9aa56bbe0d8c36cf6fe77f3e47e3e">IOTC_JWT_SIZE</a>] = {0};</div><div class="line"><span class="keywordtype">size_t</span> bytes_written = 0;</div><div class="line"><a class="code" href="d4/d7c/iotc__error_8h.html#a31af29ceaf88c8f978117b3be5545932">iotc_state_t</a> state = <a class="code" href="d8/df1/iotc__jwt_8h.html#af6e4cdf9d89a98a916b8584a03c03e4e">iotc_create_iotcore_jwt</a>(</div><div class="line">  iotc_project_id,</div><div class="line">  3600,</div><div class="line">  &amp;iotc_connect_private_key_data,</div><div class="line">  jwt,</div><div class="line">  <a class="code" href="d8/df1/iotc__jwt_8h.html#ac7a9aa56bbe0d8c36cf6fe77f3e47e3e">IOTC_JWT_SIZE</a>,</div><div class="line">  &amp;bytes_written);</div></div><!-- fragment -->  </li>
<li>
<p class="startli">Connect to Cloud IoT Core:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> iotc_device_path = <span class="stringliteral">&#39;projects/PROJECT_ID/locations/REGION/registries/REGISTRY_ID/devices/DEVICE_ID&#39;</span>;</div><div class="line"><span class="keyword">const</span> uint16_t connection_timeout = 10;</div><div class="line"><span class="keyword">const</span> uint16_t keepalive_timeout = 20;</div><div class="line"></div><div class="line"><a class="code" href="d9/d22/iotc_8h.html#a48ab2dda7fedc71942119642f5b0e9c2">iotc_connect</a>(iotc_context, /NULL, jwt,</div><div class="line">           iotc_device_path, connection_timeout,</div><div class="line">           keepalive_timeout);</div></div><!-- fragment --><p class="endli">The <a class="el" href="d9/d22/iotc_8h.html#a48ab2dda7fedc71942119642f5b0e9c2">iotc_connect()</a> function sends a CONNECT message to the Cloud IoT Core MQTT broker. The MQTT topic is the <a href="https://cloud.google.com/iot/docs/how-tos/mqtt-bridge#configuring_mqtt_clients">device path</a>.  </p>
</li>
<li>
<p class="startli">Publish a telemetry event to Cloud IoT Core:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> msg = <span class="stringliteral">&#39;Hello world&#39;</span>;</div><div class="line"><span class="keyword">const</span> <a class="code" href="d1/d03/iotc__mqtt_8h.html#a011f590a26669b801848d09460012c26">iotc_mqtt_qos_t</a> qos = 1;</div><div class="line"></div><div class="line"><a class="code" href="d9/d22/iotc_8h.html#ad182450f87d708b57451afadee80d94f">iotc_publish</a>(iotc_context, iotc_device_path</div><div class="line">           msg, qos);</div></div><!-- fragment --><p class="endli">The <a class="el" href="d9/d22/iotc_8h.html#ad182450f87d708b57451afadee80d94f">iotc_publish()</a> function sends a PUBLISH message to the MQTT broker. The payload of the message is the telemetry event.  </p>
</li>
</ol>
<h2>Build the client application</h2>
<p>The SDK builds with <code>make</code>, so the build configuration is in makefiles. Build client applications on the target deviceâ€”not your workstation.</p>
<p>To build a client application with the default build configuration:</p>
<ol>
<li>
Run <code>make</code> from the <a href="https://github.com/GoogleCloudPlatform/iot-edge-sdk-embedded-c">root directory</a> of the SDK.  </li>
<li>
<p class="startli">Create a makefile (called <code>Makefile</code>) in the root directory of the client application. This makefile specifies build rules and targets for your client application.</p>
<p class="interli">On native Linux devices, you can use the configurations in <a href="../../../examples/common/rules.mk"><code>rules.mk</code></a> and <a href="../../../examples/common/targets.mk"><code>targets.mk</code></a>. Copy them to the root directory of your client application and include them in the makefile:</p>
<div class="fragment"><div class="line">include rules.mk</div><div class="line">include targets.mk</div></div><!-- fragment -->  </li>
<li>
Run <code>make</code> from the root directory of your client application. <code>make</code> compiles the program and generates an executable. </li>
</ol>
<h2>Start the client application</h2>
<p>Run the executable to start your client application:</p>
<div class="fragment"><div class="line">./my_iot_app.exe</div></div><!-- fragment --><h1>File summary</h1>
<p>The library functions are in:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">File  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html" title="Connects to and communicates with Cloud IoT Core.">iotc.h</a>  </td><td class="markdownTableBodyNone">Connects to and communicates with Cloud IoT Core   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d4/d7c/iotc__error_8h.html" title="Defines state messages and their numeric codes.">iotc_error.h</a>  </td><td class="markdownTableBodyNone">Defines state messages and their numeric codes   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d8/df1/iotc__jwt_8h.html" title="Creates JSON Web Tokens.">iotc_jwt.h</a>  </td><td class="markdownTableBodyNone">Creates JSON Web Tokens   </td></tr>
</table>
<p>See [File list]() for a complete file reference, including files with only helper functions.</p>
<h1>Function summary</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#a46c2bce3b6a5c637136cc9b4414dcdd2" title="Removes a scheduled task from the internal event system.">iotc_cancel_timed_task()</a>  </td><td class="markdownTableBodyNone">Removes a scheduled task from the internal event system.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#a48ab2dda7fedc71942119642f5b0e9c2" title="Connects to Cloud IoT Core.">iotc_connect()</a>  </td><td class="markdownTableBodyNone">Connects to Cloud IoT Core.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#a42c951dc7534f8e90075a38c77c77fa7" title="Connects to a custom MQTT broker endpoint.">iotc_connect_to()</a>  </td><td class="markdownTableBodyNone">Connects to a custom MQTT broker endpoint.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#a657294c0f1cda3a8ec5a2bb284709657">iotc_create_context()</a>  </td><td class="markdownTableBodyNone">Creates a connection context.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d8/df1/iotc__jwt_8h.html#af6e4cdf9d89a98a916b8584a03c03e4e">iotc_create_iotcore_jwt()</a>  </td><td class="markdownTableBodyNone">Creates a JSON Web Token.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#a18b8276f88ce6816e67c1c1b23edd534" title="Frees the provided context.">iotc_delete_context()</a>  </td><td class="markdownTableBodyNone">Frees the provided context.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#abf6bc8892b8651c9dac35e5c471c96fc">iotc_events_process_blocking()</a>  </td><td class="markdownTableBodyNone">Invokes the event processing loop and executes the Device SDKs event engine as the main application process.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#af3efc2d5d965a14116fb8fdbd3a4e45e">iotc_events_process_tick()</a>  </td><td class="markdownTableBodyNone">Invokes the event processing loop on RTOS or non-OS devices that must yield for standard tick operations.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#a3809c15f5bbf5f7a2a569c11b87a29dc" title="Shuts down the event engine.">iotc_events_stop()</a>  </td><td class="markdownTableBodyNone">Shuts down the event engine.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#ab3776b294b3519517800caac107a7f1f">iotc_get_heap_usage()</a>  </td><td class="markdownTableBodyNone">Gets the amount of heap memory allocated to the Device SDK.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#a0c9d889e50010a06c7255301c3cf62ac" title="Gets the connection timeout.">iotc_get_network_timeout()</a>  </td><td class="markdownTableBodyNone">Gets the <a class="el" href="d9/d22/iotc_8h.html#a9823988b2ba20b09a483fdf9678ce8b3">connection timeout</a>.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d4/d7c/iotc__error_8h.html#a3c1a0d0d2e3b0263fb9ac191c9f08321" title="Gets the state message associated with a numeric code.">iotc_get_state_string()</a>  </td><td class="markdownTableBodyNone">Gets the <a class="el" href="d4/d7c/iotc__error_8h.html#a31af29ceaf88c8f978117b3be5545932">state message</a> associated with a numeric code.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#a949c6fa4e75efb1814aa5cbedf742c12">iotc_initialize()</a>  </td><td class="markdownTableBodyNone">Initializes the BSP time and random number libraries.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#a51e7d4bc247d4c598bbac21853f9124c" title="Checks if a context is connected to Cloud IoT Core.">iotc_is_context_connected()</a>  </td><td class="markdownTableBodyNone">Checks if a context is <a class="el" href="d9/d22/iotc_8h.html#a48ab2dda7fedc71942119642f5b0e9c2">connected to Cloud IoT Core</a>.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#ad182450f87d708b57451afadee80d94f" title="Publishes a message to an MQTT topic.">iotc_publish()</a>  </td><td class="markdownTableBodyNone">Publishes a message to an MQTT topic.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#aea56344dbfbfd50707294338794920d8" title="Publishes binary data to an MQTT topic.">iotc_publish_data()</a>  </td><td class="markdownTableBodyNone">Publishes binary data to an MQTT topic.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#a94df42c7e1af9033f06886ff2be63826" title="Executes a function after an interval and returns a unique ID for the scheduled task.">iotc_schedule_timed_task()</a>  </td><td class="markdownTableBodyNone">Executes a function after an interval and returns a unique ID for the scheduled task.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#a9faf4c4d92b699c8aec91e01e6f49b70" title="Sets the file operations to custom file management functions.">iotc_set_fs_functions()</a>  </td><td class="markdownTableBodyNone">Sets the file operations to <a href="../../bsp/html/d8/dc3/iotc__bsp__io__fs_8h.html">custom file management functions</a>.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#a4df01ad5208e12c76f6764293f5d8ad5">iotc_set_maximum_heap_usage()</a>  </td><td class="markdownTableBodyNone">Sets the maximum heap memory that the Device SDK can use.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#a9823988b2ba20b09a483fdf9678ce8b3" title="Sets the connection timeout.">iotc_set_network_timeout()</a>  </td><td class="markdownTableBodyNone">Sets the connection timeout.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#ac5bb467d736cd8b6e8de62e8a5fdda23">iotc_shutdown()</a>  </td><td class="markdownTableBodyNone">Shuts down the Device SDK and frees all resources created during <a class="el" href="d9/d22/iotc_8h.html#a949c6fa4e75efb1814aa5cbedf742c12">initialization</a>.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#ada03683c17e3cf3c5ed286e040140dc9" title="Disconnects asynchronously from an MQTT broker.">iotc_shutdown_connection()</a>  </td><td class="markdownTableBodyNone">Disconnects asynchronously from an MQTT broker.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d9/d22/iotc_8h.html#aca7aacc10616954169bff4eed5bfc834" title="Subscribes to an MQTT topic.">iotc_subscribe()</a>  </td><td class="markdownTableBodyNone">Subscribes to an MQTT topic.   </td></tr>
</table>
<h1>Board Support Package</h1>
<p>The Device SDK calls <a href="../../bsp/html/index.html">the hardware-specific drivers and routines</a> in the Board Support Package (BSP) to implement the MQTT protocol.</p>
<p>The SDK has a turn-key POSIX BSP, so it builds natively on POSIX platforms. You can customize the BSP to port the SDK to non-POSIX platforms. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
